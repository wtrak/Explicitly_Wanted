<!DOCTYPE html>
<html>
<head>
  <title>Explicitly Wanted</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { margin-top: 0; }
    .card { background: #fff; padding: 15px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; }
    .tags { margin-top: 10px; }
    .tag { display: inline-block; background: #eee; padding: 5px 10px; margin: 3px; border-radius: 3px; font-size: 12px; }
    .button { background: black; color: white; padding: 10px 20px; border: none; cursor: pointer; margin-bottom: 30px; }
    .form-section { background: #fff; padding: 20px; border-radius: 5px; border: 1px solid #ccc; margin-top: 50px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .checkbox-group label { display: flex; align-items: center; gap: 5px; font-size: 14px; }
  </style>
</head>
<body>

<h1>Explicitly Wanted</h1>
<button class="button" onclick="document.getElementById('form-section').scrollIntoView({ behavior: 'smooth' });">Post a Request</button>

<div id="listings">Loading posts...</div>

<div class="form-section" id="form-section">
  <h2>Submit a New Request</h2>
  <p><strong>Send exactly 1 USDT (TRC20)</strong> to: <code>TGW56spanMC3ywvMh5JPP3Dkd3BzjuemHy</code></p>
  <p>⚠️ Make sure to include fees. Only exact 1 USDT will unlock posting. No refunds.</p>
  <label for="txid">Transaction ID:</label>
  <input type="text" id="txid" placeholder="Paste your TXID here">

  <form id="postForm" onsubmit="submitPost(event)">
    <label>Title:<input type="text" id="title" required></label>
    <label>Description:<textarea id="description" required></textarea></label>
    <label>Budget:<input type="number" id="budget" required></label>
    <label>Email:<input type="email" id="email" required></label>
    <label>Phone:<input type="tel" id="phone" required></label>

    <label>Hair Color:
      <select id="hair">
        <option>Blonde</option><option>Brunette</option><option>Black</option><option>Red</option>
        <option>Yellow</option><option>Orange</option><option>Pink</option><option>Blue</option>
        <option>Purple</option><option>Green</option>
      </select>
    </label>
    <label>Body Type:
      <select id="body">
        <option>Thin</option><option>Toned</option><option>Full Figured</option><option>Petite</option>
      </select>
    </label>
    <label>Ethnicity:
      <select id="ethnicity">
        <option>White</option><option>Mediterranean</option><option>Asian</option><option>Black</option>
        <option>Latina</option><option>Middle Eastern</option><option>Mixed</option>
      </select>
    </label>

    <label>Tags:</label>
    <div class="checkbox-group" id="tagsContainer"></div>

    <button type="submit">Submit Post</button>
  </form>
  <p id="formMessage"></p>
</div>

<script>
const client = supabase.createClient(
  'https://ymqrgvecwkzfschatnfe.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltcXJndmVjd2t6ZnNjaGF0bmZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0Njg2NTMsImV4cCI6MjA2NDA0NDY1M30.zSND83nQpbBZfDuy7uHHL8fZa1ndGjPgWLOctkfxN5g'
);

const getblockEndpoint = "https://go.getblock.us/f579c1dc4ff34d559c1aae60bac442d3";
const walletHex = "0xf1d3e38560722a71234860cfd68b898fb2ecae4a";

const TAG_OPTIONS = [
  "Naughty", "Sweet", "Playful", "Submissive", "Dominant", "Bold", "Shy", "Flirty",
  "Lingerie", "Oil Play", "Toys", "Foot Play", "Teasing", "JOI", "Dirty Talk", "Dancing",
  "Striptease", "Shower", "Cosplay", "Dom/Sub", "Kinky", "Fetish", "Rough", "Romantic",
  "Realistic", "POV", "Roleplay"
];

function populateTags() {
  const container = document.getElementById("tagsContainer");
  TAG_OPTIONS.forEach(tag => {
    const label = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.name = "tags";
    checkbox.value = tag;
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(tag));
    container.appendChild(label);
  });
}

async function fetchListings() {
  const { data, error } = await client
    .from("posts")
    .select("*")
    .eq("status", "Active")
    .order("created_at", { ascending: false });

  const container = document.getElementById("listings");
  container.innerHTML = "";

  if (error) {
    console.error("Fetch error:", error);
    container.innerHTML = "<p>Failed to load posts.</p>";
    return;
  }

  data.forEach(post => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <strong>${post.title}</strong><br>
      <small>$${post.budget}</small>
      <p>${post.description}</p>
      <div class="tags">${(post.tags || []).map(t => `<span class='tag'>${t}</span>`).join("")}</div>
    `;
    container.appendChild(card);
  });
}

async function submitPost(e) {
  e.preventDefault();
  const resultBox = document.getElementById("formMessage");
  resultBox.textContent = "Verifying payment...";
resultBox.textContent = "Skipping payment verification for testing...";

// Simulate successful payment check
const txid = "TEST_TXID";


  const tags = Array.from(document.querySelectorAll('input[name="tags"]:checked')).map(cb => cb.value);

  const { error } = await client.from("posts").insert({
    txid,
    title: document.getElementById("title").value,
    description: document.getElementById("description").value,
    budget: parseFloat(document.getElementById("budget").value),
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
    hair_color: document.getElementById("hair").value,
    body_type: document.getElementById("body").value,
    ethnicity: document.getElementById("ethnicity").value,
    tags,
    status: "Active"
  });

  if (error) {
    console.error("Insert error:", error);
    resultBox.textContent = "Failed to submit post.";
  } else {
    resultBox.textContent = "Post submitted successfully!";
    document.getElementById("postForm").reset();
    fetchListings(); // refresh
  }
}

async function init() {
  populateTags();
  await fetchListings();
}

init();
</script>

</body>
</html>
